# 操作系统



#### 什么是中断和异常

中断和异常都会导致处理器暂停处理当前任务，转而执行一个特定的处理程序（中断处理程序/异常处理程序）

1、中断由系统外部事件触发，通常与硬件有关。目的是及时响应重要事件而中断正常程序

2、异常由系统内部事件触发，与正在执行的程序和指令有关，如非法操作、溢出等



#### 用户态和内核态

用户态和内核态是操作系统为了保护资源和实现权限控制而设计的两种不同的cpu运行级别

用户态：程序只能访问受限的资源和运行受限的指令集，不能访问核心部分和硬件资源

内核态：特权级别，可执行特权指令和操作系统的核心部分，可直接访问硬件资源

以下场景下会发生用户态与内核态的转变：用户态->内核态

系统调用：用户程序请求操作系统提供服务

异常：程序执行过程中出现错误和异常，CPU会切换到内核态以便处理问题

中断：外部设备产生中断信号，操作系统会切换到内核态处理这些中断，执行中断处理程序



#### 并行和并发

并行：同一时刻同时执行多个任务，每个任务在不同的处理单元（多个CPU核心）上。在并行系统中，多个处理单元同时执行独立的子任务，加快整体任务的完成

并发：在同一时间段内执行多个任务，这些任务可能通过时间片轮转或事件驱动方式交替执行。通常与任务调度有关





#### 内部碎片和外部碎片

内部碎片：分配给进程的内存块比实际所需内存更大，造成未被使用的小部分内存浪费在已分配的块中。

解决方案：使用动态分区分配，根据进程需求分配刚好合适的内存大小；采用更小的页框大小（分页系统）



外部碎片：虽然内存中有足够的空闲空间，但是空间被分为多个小块，无法满足某些大进程的连续内存需求

解决方案：

内存紧缩：定期整理内存，将分散的小块合并成较大的连续块

最佳适配：内存分配时选择最接近需求的连续块

分页或分段：避免进程必须占用连续的物理内存



#### 信号和信号量的区别

信号：一种处理异步事件的方式，用于通知进程有某种事件的发生，除了用于进程外，还可以发送信号给进程本身

信号量：进程间通信处理同步互斥的机制，负责协调各个线程，保证它们能正确合理的使用公共资源



#### 局部性原理

时间局部性：如果一个数据被访问，不久的将来它可能再次被访问，意味着程序在短时间内倾向于使用相同的数据项

利用时间局部性，可以将频繁使用的数据存储在缓存中，提高程序执行速度

空间局部性：如果一个数据被访问，他相邻的数据也可能被访问，意味着程序倾向于使用相邻的数据项

利用空间局部性，可以将相关数据块放在相邻的磁盘扇区上，以便快速访问



### 线程、进程



#### 进程、线程的区别

进程是系统进行资源分配和调度的最小单位

线程是系统进行运算调度的最小单位，线程是进程的子任务，是进程的执行单元，一个进程可以有一个或多个线程，这些线程共享同一块内存

资源开销：

进程：每个进程都有独立的内存空间，进程切换需要保存和恢复整个进程状态，上下文切换开销较高

线程：线程共享相同的内存空间，创建和销毁的开销较小，只需要保存和恢复少量的线程上下文

通信与同步：

进程：进程间相互隔离，需要特殊的通信机制，如管道，消息队列，共享内存等

线程：线程共享内存空间，可以直接访问共享数据

安全性：

进程：进程间相互隔离，一个进程崩溃不会影响其他进程稳定性

线程：线程共享内存空间，一个线程错误可能会影响整个进程稳定性



#### 进程的状态

创建状态：创建之初需要申请一个空白PCB，并向其中填写控制和管理进程的信息，完成资源分配

就绪状态：进程已经准备好，已分配到所需资源，分配到CPU可以立即执行

执行状态：处于就绪状态被调度后，进入执行状态

阻塞状态：正在执行的进程由于某些事件暂时无法运行，在处理完成这些事件后进入就绪状态

终止状态：进程结束，或出现错误，或被系统终止，无法再执行



#### 僵尸进程和孤儿进程

孤儿进程：一个父进程退出，但它的一个或多个子进程还在运行，那么这些子进程将成为孤儿进程，将被init()进程收养，由init()进程对它们完成状态收集工作

僵尸进程：一个进程使用fork创建子进程，如果子进程退出，父进程没有调用wait或waitpid获取子进程的状态信息，那么子进程的描述符仍然保持在系统中。这种进程称作僵尸进程





#### 进程间的通信方式

管道：半双工，数据只能单向流动而且只能在父子进程中使用

命名管道：半双工，允许无亲缘关系进程间通信

信号量：一种计数器，控制多个进程对共享资源的访问，常作为一种锁机制

消息队列：消息队列是消息的链表，存放在内核中并由标识符标识，克服了信号传递信息少，管道数据只能使用无格字节流、缓冲区小的缺点

信号：通知接收进程某个事件已发生

共享内存：映射一段能被其他进程访问的内存，由一个进程创建，多个进程访问。速度最快，通常与信号量配合使用

socket套接字：支持TCP/IP网络通信的基本操作单元，主要用于客户端与服务器通信



#### 线程同步方式

为了保证线程之间互不干扰的机制

互斥锁：最常见的线程同步机制，只允许一个线程访问被保护的临界区

条件变量：用于线程间通讯，允许线程等待某个条件满足，其他线程可以发出通知等待线程，与互斥锁一起使用

读写锁：允许多个线程同时读取共享资源，只允许一个线程写入资源

信号量：用于控制多个线程对共享资源进行访问的工具



#### 锁的种类

两个基础锁：

互斥锁：用于互斥访问共享资源，任何情况下只有一个线程可以持有互斥锁

自旋锁：一种基于忙等待的锁，线程在尝试获得锁时会不断轮询，直到锁被释放

其他锁基于以上两个锁：

读写锁：允许多个线程同时读，一个线程写，分为读状态和写状态

悲观锁：认为多线程同时修改共享资源的概率较高，所以访问共享资源时要上锁

乐观锁：先不管，修改了资源再说，如果出现同时修改的情况，再放弃本次操作



#### 死锁

两个或多个进程争夺系统资源时，互相等待对方释放资源，而无法继续执行

**产生原因：**

同时满足以下四个条件：

互斥条件：一个进程占用某资源，其他进程无法同时占用

请求保持条件：一个进程因请求资源而阻塞时，不会释放自己的资源

不可剥夺条件：资源不能被强制性的从一个进程剥夺，只能由持有者自愿释放

环路等待条件：多个进程形成一个环形等待资源的链



**如何解除：**

破坏任一条件即可解除死锁

破坏请求与保持条件：一次性申请所有资源

破坏不可剥夺条件：占用资源的线程申请其他资源时，若申请不到，主动释放占有的资源

破坏循环等待条件：靠按序申请资源来预防，所有进程按相同顺序申请资源，释放资源则反序释放



#### 进程调度算法

1、批处理系统中的调度

（1）先来先服务：非抢占式的调度算法，有利于长作业，不利于短作业

（2）最短作业优先：非抢占式的调度算法，长作业有可能会饿死

（3）最短剩余时间优先：最短作业优先的抢占式版本，按剩余运行时间顺序

2、交互式系统中的调度

（1）时间片轮转调度：所有就绪进程按先来先服务的原则排队，每个进程运行一个或多个时间片

（2）优先级调度：为每个进程分配一个优先级，按优先级进行调整，为防止饿死，可以随时间调整优先级

（3）多级队列：设置多个队列，每个队列时间片大小都不同，进程在一个队列没有执行完时会被转移到下一个队列。每个队列优先权不同，最上面的队列优先级最高。这种算法可以看作是时间片轮转和优先级调度的结合

（4）最短进程优先：通过运行最短进程使得总的等待时间最短



#### 分段和分页的区别

分段：

基本单位：地址空间被划分为不同的逻辑段，每个段具有独立的含义，如代码段，数据段

段的长度：可以动态变化

碎片：按逻辑结构划分内存，可动态变化，避免了内部碎片，会导致外部碎片

逻辑地址：段号+段内偏移

分页：

基本单位：地址空间被分为固定大小的页面，物理内存也被划分为相同大小的页面框

页面的长度：长度固定，由操作系统定义

碎片：固定大小的页管理内存，避免外部碎片，导致内部碎片

逻辑地址：页号+页内偏移

现代操作系统采用段页式存储，先分段，再分页



#### 页面置换算法

LRU（最近最少使用）：每次选择最长时间没有被使用的页面进行换出，需要记录使用时间或维护顺序的列表

FIFO（先进先出）：每次选择最早进入内存的页面换出，只需维护一个队列，换出队首的页面，新加入的在队尾

OPT（最佳页面置换算法）：换出未来最长时间不使用的页面，这个算法为理想状态，无法实际实现，作为衡量标准

时钟页面置换算法：所有页面保存在环形链表中，设定一个访问位置1，缺页中断时遍历页面，将访问位的1改0，直到遇到访问位为0的页面进行置换

最不常用算法：计算每个页面的访问次数，置换出访问最少的页面。需要额外开销统计访问次数



#### IO多路复用

允许一个进程同时监听多个I/O事件，并且在有事件发生时通知进程，而无需进程阻塞或轮询

三种主要机制：

select：早期机制，用数组存储文件描述符，适用于小规模并发

poll：改进版select，用链表存储文件描述符 ，适用于中等规模

epoll：高性能，仅Linux可用，适用大规模高并发

epoll高性能原理：select和poll要求遍历所有文件，而epoll仅在事件发生时才通知进程；使用红黑树存储事件，降低增删改复杂度；用户态与内核态只在注册时交互一次，而不是每次调用都交互



### Linux



#### 常用命令

ls：列出当前目录下的文件和子目录

cd：切换目录

pwd：显示当前工作目录的路径

touch：创建新文件

mkdir：创建目录

rm：删除文件或目录

cp：复制文件或目录

mv：移动文件或目录，也用于重命名

cat：显示文件内容

vi/vim：编辑文件

head/tail：查看文件开头/结尾部分

grep：筛选字符串

find：查找文件或目录

chmod：更改权限

chown：更改所有者

ps：列出使用中的进程

kill：终止进程

df：显示磁盘使用情况

tar：创建和提取归档文件（压缩解压缩）

ifconfig：IP地址

ping：测试网络连接

ssh：使用ssh远程登录

apt/yum：包管理器，安装、更新、删除软件包



#### netstat

1、netstat的作用

用于显示网络连接，路由表、接口统计信息，常用于排查网络问题

2、netstat默认输出包含哪些信息

本地地址、远程地址、连接状态、协议类型

3、常用参数

| 参数 | 作用                                      |
| ---- | ----------------------------------------- |
| `-a` | 显示所有连接和监听端口                    |
| `-n` | 以数字形式显示地址和端口号（不做DNS解析） |
| `-t` | 显示 TCP 协议连接                         |
| `-u` | 显示 UDP 协议连接                         |
| `-l` | 只显示正在监听的服务端口                  |
| `-p` | 显示与每个连接关联的进程 ID               |
| `-s` | 显示网络统计信息                          |

4、替代工具

`netstat` 和 `ss` 有什么区别？

ss 更快、更详细，是 iproute2 工具集的一部分，未来可能替代 netstat。













